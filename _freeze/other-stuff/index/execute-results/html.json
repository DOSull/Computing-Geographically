{
  "hash": "2a6bf452868c8ac03fd1762713b89663",
  "result": {
    "markdown": "---\ntitle: Other stuff\nsubtitle: Bits and pieces that might be of interest\ncategories:\n  - extras\n  - code\n  - R\n# listing:\n#   categories: true\n#   contents:\n#     - \"cover-art.qmd\"\n#   sort: false\n#   type: grid\nexecute: \n  cache: true\n  freeze: auto\nknitr:\n  opts_chunk: \n    warning: false\n    message: false\n---\n\n\nFor now, this is just one page about how I made the cover art. In time I might expand it to cover other aspects of the book, why I wrote it, lost chapters/threads that didn't make it, a picture of Rosa the cat, 'how I wrote a book and still lost my job', and so on.\n\nBut for now, here's how I made the cover art.\n\n## A flocking model\nThe starting point was a *flocking model*, which is discussed in Chapter 8 of the book, in &sect;Agent-Based Models, but also makes an appearance in Figure 7.7. This model was previously made for my earlier book _Spatial Simulation_ written with George Perry, which you can find all about [here](https://patternandprocess.org). Specifically [this NetLogo model](https://dosull.github.io/pattern-and-process/chapter-4/4.7.html) appears in the [model zoo](https://dosull.github.io/pattern-and-process/#the-model-zoo), as an implementation of ideas in these papers\n\n> Czirók A and T Vicsek. 2000. Collective behavior of interacting self-propelled particles. _Physica A: Statistical Mechanics and its Applications_ **281** 17–29.\n\n> Grégoire G, H Chaté and Y Tu. 2003. Moving and staying together without a leader. _Physica D: Nonlinear Phenomena_ **181** 157–70.\n\n> Vicsek T, A Czirók, E Ben-Jacob, I Cohen and O Sochet. 1995. Novel type of phase transition in a system of self-driven particles. _Physical Review Letters_ **75** 1226–29.\n\nYou can play with a (rather slow, because the web version is slow) version of that model [here](https://southosullivan.com/misc/4.7-flocking.html). If you download and run it locally, you'll find some commented out code at the end that implements a save-history procedure that means you can run the model for a bit then get a CSV file with ID, x, y, and t output for the flockers, which is the basis for the cover art.\n\n## The space-time traces\nSo, after importing some packages, read in one of those output files. There's an [example here](traces.csv), should you wish to make your own alternative cover.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-1_c17c1341794f145091dff220a9f95d71'}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(tmap)\nlibrary(dplyr)\nlibrary(units)\n\nxy <- read.table(\"traces.csv\", sep = \" \", header = TRUE)\n```\n:::\n\n\nWe don't need all the time steps in that file, so cut it down a bit and convert into a simple features dataset:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-2_8ecd1d4386ee03caeb93db059079cc9b'}\n\n```{.r .cell-code}\nsteps <- seq(1, 50, 1)\n\nxy <- xy %>%\n  mutate(x = x + 1.75e6, y = y + 5.5e6) %>%\n  filter(t %in% steps)\n\nxy_sf <- xy %>%\n  st_as_sf(coords = c(\"x\", \"y\"), crs = 2193)\n```\n:::\n\n\nBefore we go any further, we need a 'frame' for all the layers we'll be using, so this is made from the extent of the included points, inset a little. Insetting avoids some otherwise strange edge effects.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-3_447450372619f5a92be51a29e60a52c4'}\n\n```{.r .cell-code}\nxy_inset <- xy_sf %>%\n  st_bbox() %>%\n  st_as_sfc() %>%\n  st_sf() %>%\n  st_set_crs(2193) %>%\n  st_buffer(-.5)\n```\n:::\n\n\nThe underlying basis of the cover art is those traces, which we need to form into a lines dataset and clip to the frame.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-4_607e625a9c7aa9411fa800bf320566c7'}\n\n```{.r .cell-code}\nxy_path <- xy_sf %>%\n  group_by(who) %>%\n  summarise(do_union = FALSE) %>%\n  st_cast(\"LINESTRING\") %>% \n  st_intersection(xy_inset)\n```\n:::\n\n\nSo this is what we've got so far:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-5_2d83771df7d3e404d84a0c4eb6d7101a'}\n\n```{.r .cell-code}\ntm_shape(xy_path) + \n  tm_lines(lwd = 0.5)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Voronoi polygons of the trajectory points\nProbably you can tell that some [Voronoi magic](../chapters/chap2/fig2-07-point-voronoi.qmd) was involved:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-6_ad8b6ae5d9d436afea226f7225476f79'}\n\n```{.r .cell-code}\n# it's handy to put this in a function\nvoronoi <- function(layer) {\n  layer %>%\n    st_union() %>%\n    st_voronoi() %>%\n    st_cast() %>%\n    st_as_sf(crs = st_crs(layer)) %>%\n    st_join(layer)\n}\n\nxy_vor <- xy_sf %>%\n  voronoi() %>%\n  st_intersection(xy_inset) %>%\n  distinct(geometry)\n```\n:::\n\n\nAnd here is what we have got so far:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-7_07ea231633bbcd9d693cbbf8cb920a1c'}\n\n```{.r .cell-code}\ntm_shape(xy_vor) +\n  tm_borders(col = \"blue\", lwd = 0.35) +\n  tm_shape(xy_path) + \n  tm_lines(lwd = 0.5)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nwhich is already pretty interesting looking.\n\n## Overlapping Voronoi polygons\nThe cover depends on overlapping the Voronoi polygons, which when coloured with some transparency gives the final effect. So some buffering (the original sin of GIS!) required. I decided after much experimentation to make the buffers larger for the bigger polygons.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-8_ce55ce455df95a35e6c983e7b1f1b968'}\n\n```{.r .cell-code}\nxy_vor_b <- xy_vor %>%\n  mutate(area = st_area(.), r = as_units(.25, \"m\") + sqrt(area / pi)) %>%\n  st_buffer(.$r) %>%\n  st_intersection(xy_inset)\n```\n:::\n\n\nIn itself this is also interesting to look at:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-9_9f1ae8516388e83166b141f461e7f542'}\n\n```{.r .cell-code}\ntm_shape(xy_vor_b) + \n  tm_borders(lwd = 0.15)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## Putting it all together\nArmed with those three layers, we can do all kinds of interesting compositions. It's fun to play with the colour palettes, the transparency, the direction of the ramps, and any number of other things. Here's what I wound up using:\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-10_857844441b8975d97dd8c0b65ad7bd6f'}\n\n```{.r .cell-code}\ntm_shape(xy_vor_b)  +\n  tm_polygons(col = \"r\", alpha = 0.3, style = \"cont\", lwd = 0,\n              palette = \"-plasma\", legend.show = FALSE) +\n  tm_shape(xy_vor) +\n  tm_borders(col = \"white\", alpha = 0.35, lwd = 0.35) +\n  tm_shape(xy_path) +\n  tm_lines(col = \"white\", palette = \"Blues\", lwd = 1, alpha = 0.5) +\n  tm_layout(frame = FALSE, bg.color = \"white\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## Other computational art in _R_\nComputational 'generative' art is a lot of fun. I'd have to rewrite that NetLogo model in _R_ to make this truly an example of generative art in _R_, but _en route_ to this approach I found some interesting resources here, particularly\n\n- https://nrennie.rbind.io/portfolio/rtistry/\n- https://github.com/koenderks/aRtsy\n\nIn the end I preferred the greater control that my own 'tool-chain' gave me.\n\n## The idea behind the cover\nLoosely speaking the cover mirrors the sequence from 'simple location' to 'world as relational process' that the book recounts. A set of relationally interacting, moving, simple locations converge to become a society of actual occasions. If you have no idea what I'm on about, you'll have to read the book...\n\nIn any case, I like how it looks, and so did the publisher!\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-11_9c0783ec53e152928ba548da62267324'}\n\n```{.r .cell-code  code-fold=\"true\"}\n# License (MIT)\n#\n# Copyright (c) 2023 David O'Sullivan\n#\n# Permission is hereby granted, free of charge, to any person\n# obtaining a copy of this software and associated documentation\n# files (the \"Software\"), to deal in the Software without restriction,\n# including without limitation the rights to use, copy, modify, merge,\n# publish, distribute, sublicense, and/or sell copies of the Software,\n# and to  permit persons to whom the Software is furnished to do so,\n# subject to the following conditions:\n#\n# The above copyright notice and this permission notice shall be included\n# in all copies or substantial portions of the Software.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n# DEALINGS IN THE SOFTWARE.\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}