{
  "hash": "2af2a22c7256f21b4b36149a524ef43c",
  "result": {
    "markdown": "---\ntitle: \"Figure 3.4 ~~Three~~ twenty levels of web map hierarchy\"\ncategories: \n  - code\n  - R\n  - extras\nexecute: \n  cache: true\n  freeze: auto\nknitr:\n  opts_chunk: \n    warning: false\n    message: false\n---\n\n\nThe code below retrieves an OSM tile from level 0 all the way down to level 19 for the latitude-longitude coordinates of the [Broolyn Wind Turbine](https://maps.app.goo.gl/UzNcVcqZ2axZKhdy9) in Wellington.\n\n\n::: {.cell hash='fig3-04-webmap-tiles_cache/html/unnamed-chunk-1_46735c1606ae13a78b158799be19297e'}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(dplyr)\nlibrary(stringr)\n\n# adapted from https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#R\ndeg2num<-function(lat_deg, lon_deg, zoom){\n  lat_rad <- lat_deg * pi /180\n  n <- 2.0 ^ zoom\n  xtile <- floor((lon_deg + 180.0) / 360.0 * n)\n  ytile = floor((1 - (log(tan(lat_rad) + (1 / cos(lat_rad))) / pi)) / 2.0 * n)\n  c(xtile, ytile)\n}\n\nlon <- 174.74526\nlat <- -41.31087\n\nfor (zoom in 0:19) {\n  xy <- deg2num(lat, lon, zoom)\n  osm_tile_url <- str_glue(\"https://tile.openstreetmap.org/{zoom}/{xy[1]}/{xy[2]}.png\")\n  download.file(osm_tile_url, str_glue(\"tiles/{zoom}.png\"), mode = 'wb')\n}\n```\n:::\n\n\nHere they all are (there is probably a better way to do this, but sometimes in _R_ it's easier just to write the code).\n\n\n::: {.cell hash='fig3-04-webmap-tiles_cache/html/unnamed-chunk-2_24c96c14601c1d7da8811c9109fa3b60'}\n\n```{.r .cell-code}\nlibrary(png)\n\npar(mai = rep(0, 4))\nplot(1, xlim = c(0, 5), ylim = c(0, 4), xlab = \"\", ylab = \"\", \n     type = \"n\", asp = 1, axes = FALSE)\nfor (i in 0:19) {\n  img <- readPNG(str_glue(\"tiles/{i}.png\"))\n  rasterImage(img, i %% 5, 3 - (i %/% 5), i %% 5 + 1, 4 - (i %/% 5))\n}\n```\n\n::: {.cell-output-display}\n![](fig3-04-webmap-tiles_files/figure-html/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\nAll tiles &copy; [OpenStreetMap](https://openstreetmap.org/copyright) contributors, data under the ODbL.\n\n\n::: {.cell hash='fig3-04-webmap-tiles_cache/html/unnamed-chunk-3_1abb7f4db23ce548dffe6130ab493a29'}\n\n```{.r .cell-code  code-fold=\"true\"}\n# License (MIT)\n#\n# Copyright (c) 2023 David O'Sullivan\n#\n# Permission is hereby granted, free of charge, to any person\n# obtaining a copy of this software and associated documentation\n# files (the \"Software\"), to deal in the Software without restriction,\n# including without limitation the rights to use, copy, modify, merge,\n# publish, distribute, sublicense, and/or sell copies of the Software,\n# and to  permit persons to whom the Software is furnished to do so,\n# subject to the following conditions:\n#\n# The above copyright notice and this permission notice shall be included\n# in all copies or substantial portions of the Software.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n# DEALINGS IN THE SOFTWARE.\n```\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}