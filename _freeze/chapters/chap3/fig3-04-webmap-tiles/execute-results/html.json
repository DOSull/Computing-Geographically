{
  "hash": "7d22b8f38f848b477699bf3fa937cac9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Figure 3.4 ~~Three~~ twenty levels of web map hierarchy\"\nlightbox: true\ncategories: \n  - code\n  - R\n  - extras\nexecute: \n  cache: true\n  freeze: auto\nknitr:\n  opts_chunk: \n    warning: false\n    message: false\n---\n\n\nThe code below retrieves an OSM tile from level 0 all the way down to level 19 for the latitude-longitude coordinates of the [Broolyn Wind Turbine](https://maps.app.goo.gl/UzNcVcqZ2axZKhdy9) in Wellington.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(dplyr)\nlibrary(stringr)\n\n# adapted from https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#R\ndeg2num<-function(lat_deg, lon_deg, zoom){\n  lat_rad <- lat_deg * pi /180\n  n <- 2.0 ^ zoom\n  xtile <- floor((lon_deg + 180.0) / 360.0 * n)\n  ytile = floor((1 - (log(tan(lat_rad) + (1 / cos(lat_rad))) / pi)) / 2.0 * n)\n  c(xtile, ytile)\n}\n\nlon <- 174.74526\nlat <- -41.31087\n\ntile_names <- c()\nfor (zoom in 0:19) {\n  xy <- deg2num(lat, lon, zoom)\n  tile_name <- str_glue(\"{zoom}/{xy[1]}/{xy[2]}\")\n  tile_names <- c(tile_names, tile_name)\n  osm_tile_url <- str_glue(\"https://tile.openstreetmap.org/{tile_name}.png\")\n  download.file(osm_tile_url, str_glue(\"tiles/{zoom}.png\"), mode = 'wb')\n}\ndf <- data.frame(zoom = 0:19, tile_name = tile_names) %>%\n  mutate(left = zoom %% 5, bottom = 3 - zoom %/% 5, \n         right = left + 1, top = bottom + 1)\n```\n:::\n\n\nHere they all are (there is probably a better way to do this, but sometimes in _R_ it's easier just to write the code).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(png)\n\npar(mai = rep(0, 4))\nplot(1, xlim = c(0, 5), ylim = c(0, 4), xlab = \"\", ylab = \"\", \n     type = \"n\", asp = 1, axes = FALSE)\n\nfor (i in 1:20) {\n  img <- readPNG(str_glue(\"tiles/{df$zoom[i]}.png\"))\n  rasterImage(img, df$left[i], df$bottom[i], df$right[i], df$top[i])\n}\ntext(df$left + 0.01, df$bottom + 0.01, df$tile_name, adj = c(0, 0), cex = 0.75)\n```\n\n::: {.cell-output-display}\n![](fig3-04-webmap-tiles_files/figure-html/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\nAll tiles &copy; [OpenStreetMap](https://openstreetmap.org/copyright) contributors, data under the ODbL.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# License (MIT)\n#\n# Copyright (c) 2023 David O'Sullivan\n#\n# Permission is hereby granted, free of charge, to any person\n# obtaining a copy of this software and associated documentation\n# files (the \"Software\"), to deal in the Software without restriction,\n# including without limitation the rights to use, copy, modify, merge,\n# publish, distribute, sublicense, and/or sell copies of the Software,\n# and to  permit persons to whom the Software is furnished to do so,\n# subject to the following conditions:\n#\n# The above copyright notice and this permission notice shall be included\n# in all copies or substantial portions of the Software.\n#\n# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n# DEALINGS IN THE SOFTWARE.\n```\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}